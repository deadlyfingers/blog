<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Developer blog">
  <title>Setup Mobile Service table permissions and authentication</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/assets/main.css" rel="stylesheet">
  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Deadlyfingers.net" />
</head>

<body>
  <div class="grid-container">
    <!-- nav -->
    <div class="grid-x">
  <div class="small-6 cell">
    <h1><a href="/">Deadlyfingers.net</a></h1>
  </div>
  <div class="small-6 cell right">
    <a class="icon twitter" href="https://twitter.com/deadlyfingers"></a>
    <a class="icon github" href="https://github.com/deadlyfingers"></a>
    <a class="icon youtube" href="https://youtube.com/deadlyfingerstv"></a>
  </div>
</div>
    <!-- body content -->
    <div class="grid-x grid-margin-x">
      <div id="post" class="large-8 cell post">
  
  <time datetime="2014-05-29 11:16:17 +0100" class="date">29 May 2014</time>
  
  <h1 class="post-title">Setup Mobile Service table permissions and authentication</h1>
  <div class="post-line"></div>
  <blockquote>
  <p>Azure Mobile Services is deprecated, please migrate to Azure App Service.</p>
</blockquote>

<h3 id="tutorial-requirements">Tutorial requirements:</h3>

<ul>
  <li><a href="http://developer.android.com/sdk/installing/studio.html">Android Studio</a></li>
  <li>Microsoft Azure account — start a free <a href="http://aka.ms/azure_trial">Azure trial</a></li>
  <li><a href="https://twitter.com">Twitter</a> account</li>
</ul>

<div class="video"><iframe src="//www.youtube.com/embed/ige5xpDsJuk" frameborder="0" allowfullscreen=""></iframe></div>

<p>This article builds on top of the <a href="http://www.deadlyfingers.net/azure/create-mobile-service-in-azure">previous tutorial</a> where an Android Todo app was created with Azure Mobile Services. However most steps can be adapted for any Mobile Services Android app.</p>

<ol>
  <li>Edit <em>TodoItem</em> table <strong>insert</strong> permissions to <em>Only Authenticated Users</em>.
  <img src="/assets/images/MS201_TablePermissions-OnlyAuthenticationUsers.png" alt="" /></li>
  <li><a href="http://apps.twitter.com">Create twitter app</a>.
  <img src="/assets/images/MS202_TwitterApps-CreateNewApp.png" alt="" />
  Copy <em>Mobile Service URL</em> from Azure Mobile Service Dashboard
  <img src="/assets/images/MS203_CopyMobileServiceURL.png" alt="" />
  Paste the Azure <em>Mobile Service URL</em> into Twitter app’s <em>Website</em> and <em>Callback URL</em> fields and save. Then in <em>Settings</em> tab tick the <em>‘Allow this application to be used Sign in with Twitter’</em> checkbox.
  <img src="/assets/images/MS204_AllowThisAppToSignInWithTwitter.png" alt="" /></li>
  <li>In Twitter app’s API Keys tab copy the <em>API key</em> &amp; <em>API secret</em>.
  <img src="/assets/images/MS205_CopyTwitterAPIKeyAndSecret.png" alt="" />
And paste them into <strong>Identity &gt; Twitter settings</strong>.
  <img src="/assets/images/MS206_PasteTwitterAPIKeyAndSecret-AzureIdentity.png" alt="" /></li>
  <li>In <strong>Android Studio</strong> <em>ToDoActivity</em> cut the code block under the new Mobile Service client.
  <img src="/assets/images/MS207_CreateTableMethod.png" alt="" />
And paste into a new method <em>createTable()</em>.
  <img src="/assets/images/MS208_CreateTableMethod.png" alt="" /></li>
  <li>Replace the code block with a new <em>authenticate()</em> method.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">private</span> <span class="kt">void</span> <span class="nf">authenticate</span><span class="o">()</span> <span class="o">{</span>
   <span class="n">mClient</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">MobileServiceAuthenticationProvider</span><span class="o">.</span><span class="na">Twitter</span><span class="o">,</span> <span class="k">new</span> <span class="n">UserAuthenticationCallback</span><span class="o">()</span> <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">MobileServiceUser</span> <span class="n">mobileServiceUser</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">ServiceFilterResponse</span> <span class="n">serviceFilterResponse</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">==</span><span class="kc">null</span><span class="o">)</span>
       <span class="o">{</span>
         <span class="n">createAndShowDialog</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"You are signed in as %s"</span><span class="o">),</span> <span class="n">mobileServiceUser</span><span class="o">.</span><span class="na">getUserId</span><span class="o">()</span> <span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span>
       <span class="o">{</span>
         <span class="n">createAndShowDialog</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span><span class="s">"Error"</span><span class="o">);</span>
       <span class="o">}</span>
     <span class="o">}</span>
   <span class="o">});</span>
 <span class="o">}</span>
</code></pre></div>    </div>
    <p>Then build and run
  <img src="/assets/images/MS209_AuthenticateMethod-BuildandRun.png" alt="" /></p>
  </li>
  <li>Sign-in with Twitter.
  <img src="/assets/images/MS210_TwitterSignIn.png" alt="" /></li>
  <li>You can record the <em>userId</em> on the server-side. Edit table <strong>Script &gt; Insert</strong>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span>
 <span class="p">{</span>
   <span class="nx">item</span><span class="p">.</span><span class="nx">userId</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">userId</span><span class="p">;</span>
   <span class="nx">request</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
 <span class="p">}</span>
</code></pre></div>    </div>
    <p><img src="/assets/images/MS211_TodoItem-Script-Insert-UserId.png" alt="" /></p>
  </li>
  <li>Add another Todo item in the app.
  <img src="/assets/images/MS212_Add-TodoItem-UserId.png" alt="" />
  Refresh the <em>ToDoItem</em> table to see the new item with <em>userId</em>.
  <img src="/assets/images/MS213_Browse-TodoItem-userId-Refresh.png" alt="" /></li>
  <li>Now change <strong>Script &gt; Read</strong> so app shows only the authenticated user’s items.
  <img src="/assets/images/MS214_TodoItem-Table-Script-Read-where-userId.png" alt="" />
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">read</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> 
  <span class="p">{</span>
 <span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">({</span><span class="na">userId</span><span class="p">:</span><span class="nx">user</span><span class="p">.</span><span class="nx">userId</span><span class="p">});</span>
 <span class="nx">request</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Refresh app to see changes.
  <img src="/assets/images/MS215_Refresh-Todo-Items.png" alt="" />
  The list should only show ToDo items that belong to that user now.
  <img src="/assets/images/MS216_Refresh-Todo-Items.png" alt="" /></li>
</ol>

<h3 id="impressive--with-just-a-couple-of-lines-of-code-the-app-is-updated-to-enable-user-authentication-and-handle-identity-requests">Impressive — with just a couple of lines of code the app is updated to enable user authentication and handle identity requests.</h3>

<p>Azure Mobile Services also allows you to send Push Notifications which is covered in the <a href="http://www.deadlyfingers.net/azure/send-gcm-push-notifications-using-azure-mobile-service">next tutorial</a>.</p>


</div>

<div class="large-4 cell">
  <!-- <a href="http://example.com/bar.html#disqus_thread">Link</a> -->

</div>

<div id="pagination" class="large-12 cell">
  <div>
    <a href="/tutorial/setup-mobile-service-table-permissions-and-authentication">Setup Mobile Service table permissions and authentication</a>
    <span>
      
      <span>by David Douglas</span>
      
    </span>
  </div>
  <ul class="tags">
    
    <li>Android</li>
    
    <li>Azure</li>
    
    <li>Mobile Services</li>
    
  </ul>

  <div class="grid-x grid-margin-x grid-padding-y">
    <div class="large-6 cell">
      
      <span class="next">Next</span>
      <a href="/tutorial/send-gcm-push-notifications-using-azure-mobile-services">Send GCM Push Notifications using Azure Mobile Services</a>
      
    </div>
    <div class="large-6 cell">
      
      <span class="prev">Previous</span>
      <a href="/tutorial/create-mobile-service-in-azure">Create a Mobile Service in Azure</a>
      
    </div>
  </div>
  <div class="top"><a href="#" class="top">Top</a></div>
</div>
    </div>
  </div>

  <!-- scripts -->
  <!-- Global site tag (gtag.js) - Google Analytics -->

</body>